<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serie A FPL Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    

<style>
    :root {
        --bg-color: #0f0f12;
        --card-bg: #1e1e26;
        --accent-blue: #007bff;
        --accent-green: #00ff88;
        --text-main: #ffffff;
        --text-dim: #a0a0b0;
        --border: #333344;
    }

    /* FIX 1: Prevent horizontal body scroll */
    html, body {
        max-width: 100vw;
        overflow-x: hidden;
        margin: 0;
        padding: 0;
    }

    body {
        background-color: var(--bg-color);
        color: var(--text-main);
        font-family: 'Inter', -apple-system, sans-serif;
        display: block;
        min-height: 100vh;
    }

    /* Nav Bar */
    header {
        background: var(--card-bg);
        border-bottom: 1px solid var(--border);
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 1000;
    }
    
    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
    }

    .logo { font-size: 1.2rem; margin: 0; color: #fff; font-weight: bold; }
    .highlight { color: var(--accent-blue); }

    #main-nav ul {
        display: flex;
        list-style: none;
        gap: 15px;
        margin: 0;
        padding: 0;
    }

    #main-nav a {
        color: var(--text-dim);
        text-decoration: none;
        font-size: 0.85rem;
        font-weight: 500;
    }

    /* FIX 2: Responsive Table Containers */
    .table-container {
        width: 100%;
        overflow-x: auto; /* Allows table to scroll sideways if too wide */
        -webkit-overflow-scrolling: touch;
    }

    .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px 10px; /* Reduced padding for mobile */
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
    }

    .card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 15px;
        border: 1px solid var(--border);
        margin-bottom: 20px;
    }

    h2 { font-size: 1.1rem; margin-top: 0; color: var(--accent-blue); border-bottom: 1px solid var(--border); padding-bottom: 10px; }

    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; min-width: 300px; }
    th, td { padding: 10px 5px; text-align: left; border-bottom: 1px solid var(--border); }

    .crest { width: 20px; height: 20px; vertical-align: middle; margin-right: 5px; }
    .pts { font-weight: bold; color: var(--accent-green); }

    /* FIX 3: Responsive Fixtures */
    .fixture-row {
        display: flex;
        flex-wrap: wrap; /* Allows items to drop to next line on tiny screens */
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
        gap: 10px;
    }

    /* Mobile Responsive Logic */
    @media (max-width: 850px) {
        .dashboard-grid {
            grid-template-columns: 1fr; /* Stack columns vertically */
        }

        .menu-toggle { display: flex; flex-direction: column; gap: 4px; background: none; border: none; cursor: pointer; }
        .bar { width: 22px; height: 2px; background: white; }

        #main-nav { 
            display: none; 
            width: 100%; 
            position: absolute; 
            top: 60px; 
            left: 0; 
            background: var(--card-bg); 
            border-bottom: 1px solid var(--border);
        }

        #main-nav.active { display: block; }
        #main-nav ul { flex-direction: column; padding: 15px; gap: 10px; }
        
        /* Smaller font for mobile fixtures */
        .fixture-row { font-size: 0.8rem; }
    }
</style>

    
</head>
<body>

    <header>
        <div class="container header-container">
            <h1 class="logo">KOPALA <span class="highlight">FPL</span></h1>

            <button class="menu-toggle" id="mobile-menu" aria-label="Toggle navigation">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
            
            <nav id="main-nav">
                <ul>
                    <li><a href="index.html"><i class="fa-solid fa-house"></i> Home</a></li>
                    <li><a href="#live-scores"><i class="fa-solid fa-calendar-check"></i> EPL Live</a></li>
                    <li><a href="serieA.html" style="color:var(--accent-green)"><i class="fa-solid fa-futbol"></i> Serie A</a></li>
                    <li><a href="#stats-centre"><i class="fa-solid fa-chart-line"></i> Stats</a></li>
                    <li><a href="#mini-league-analyzer"><i class="fa-solid fa-trophy"></i> Leagues</a></li>
                    <li><a href="#price-tracker"><i class="fa-solid fa-dollar-sign"></i> Prices</a></li>
                    <li><a href="mailto:lombeicloud@gmail.com"><i class="fa-solid fa-user-secret"></i> Join league</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main-content">
        <div id="loader">Updating data...</div>

        <div class="dashboard-grid">
            <div class="card">
                <h2>League Table</h2>
                <table id="standings-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Club</th>
                            <th>W/D/L</th>
                            <th>GD</th>
                            <th>PTS</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body"></tbody>
                </table>
            </div>

            <div class="card">
                <h2>Top Scorers</h2>
                <table id="scorers-table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>G</th>
                        </tr>
                    </thead>
                    <tbody id="scorers-body"></tbody>
                </table>
            </div>

            <div class="card" style="grid-column: span 2;">
                <h2>Upcoming Fixtures</h2>
                <div id="fixtures-list"></div>
            </div>
        </div>
    </div>

    <script>
        // 1. Mobile Menu Toggle Logic
        const menuToggle = document.getElementById('mobile-menu');
        const mainNav = document.getElementById('main-nav');

        menuToggle.addEventListener('click', () => {
            mainNav.classList.toggle('active');
        });

        // 2. Data Fetching Logic
        const PROXY_URL = '/api/competitions/SA/'; 

        async function init() {
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
            
            try {
                const [standingsRes, scorersRes, fixturesRes] = await Promise.all([
                    fetch(`${PROXY_URL}standings`),
                    fetch(`${PROXY_URL}scorers`),
                    getFixtures()
                ]);

                const sData = await standingsRes.json();
                const scData = await scorersRes.json();
                const fData = await fixturesRes.json();

                if (sData.standings) renderStandings(sData.standings[0].table);
                if (scData.scorers) renderScorers(scData.scorers);
                if (fData.matches) renderFixtures(fData.matches);

            } catch (err) {
                console.error("Dashboard Error:", err);
                alert("Data sync failed. Check netlify.toml config.");
            } finally {
                loader.style.display = 'none';
            }
        }

        async function getFixtures() {
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 10);
            const endDate = nextWeek.toISOString().split('T')[0];
            return fetch(`${PROXY_URL}matches?dateFrom=${today}&dateTo=${endDate}`);
        }

        function renderStandings(data) {
            const body = document.getElementById('standings-body');
            body.innerHTML = data.map(team => `
                <tr>
                    <td>${team.position}</td>
                    <td><img src="${team.team.crest}" class="crest" alt=""> ${team.team.shortName}</td>
                    <td>${team.won}/${team.draw}/${team.lost}</td>
                    <td>${team.goalDifference}</td>
                    <td class="pts">${team.points}</td>
                </tr>
            `).join('');
        }

        function renderScorers(data) {
            const body = document.getElementById('scorers-body');
            body.innerHTML = data.slice(0, 10).map(s => `
                <tr>
                    <td><strong>${s.player.name}</strong><br><small style="color:var(--text-dim)">${s.team.name}</small></td>
                    <td class="pts">${s.goals}</td>
                </tr>
            `).join('');
        }

        function renderFixtures(matches) {
            const list = document.getElementById('fixtures-list');
            if (!matches || matches.length === 0) {
                list.innerHTML = '<p style="color:var(--text-dim); padding: 20px;">No upcoming matches found.</p>';
                return;
            }

            list.innerHTML = matches.map(m => {
                const date = new Date(m.utcDate).toLocaleString([], { 
                    weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                });
                return `
                    <div class="fixture-row">
                        <div style="width: 150px;"><span class="date-badge">${date}</span></div>
                        <div style="flex: 1; text-align: right;"><img src="${m.homeTeam.crest}" class="crest" alt=""> ${m.homeTeam.shortName}</div>
                        <div style="padding: 0 15px; color: var(--text-dim);">vs</div>
                        <div style="flex: 1; text-align: left;">${m.awayTeam.shortName} <img src="${m.awayTeam.crest}" class="crest" alt=""></div>
                        <div style="width: 100px; text-align: right; color: var(--accent-blue);">MD ${m.matchday}</div>
                    </div>
                `;
            }).join('');
        }

        init();
    </script>
</body>
</html>
