<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPL AI RATER 2025 | Professional Engine</title>
    <style>
        :root { --pg: #27ae60; --dark: #121212; --accent: #3498db; --gold: #f1c40f; --error: #e74c3c; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--dark); color: white; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { max-width: 500px; width: 100%; text-align: center; }
        
        /* Status & Budget */
        .status-box { font-size: 12px; padding: 10px; margin-bottom: 10px; border-radius: 6px; background: #222; border: 1px solid #333; line-height: 1.4; }
        .budget { margin: 15px 0; font-weight: bold; font-size: 1.3rem; letter-spacing: -0.5px; }
        
        /* Pitch Styles */
        .pitch { background: var(--pg); border: 4px solid white; border-radius: 12px; padding: 20px 10px; height: 500px; display: flex; flex-direction: column; justify-content: space-around; box-shadow: 0 20px 40px rgba(0,0,0,0.6); position: relative; }
        .row { display: flex; justify-content: center; gap: 8px; }
        .slot { width: 85px; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 6px; border-bottom: 3px solid var(--accent); }
        .slot label { font-size: 10px; font-weight: bold; display: block; margin-bottom: 4px; color: #888; }
        select { width: 100%; font-size: 11px; background: #000; color: #fff; border: none; cursor: pointer; outline: none; }

        /* Controls */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 25px; }
        button { padding: 14px; border-radius: 8px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; font-size: 13px; text-transform: uppercase; }
        .btn-main { grid-column: span 2; background: var(--accent); color: white; }
        .btn-opt { background: var(--gold); color: black; }
        .btn-sync { background: #333; color: #ccc; }
        button:hover { transform: translateY(-2px); filter: brightness(1.1); }
        button:active { transform: translateY(0); }

        /* Results Display */
        .results { margin-top: 25px; padding: 20px; background: #1e1e1e; border-radius: 15px; border: 1px solid #333; display: none; animation: slideUp 0.4s ease; }
        .score-val { font-size: 64px; font-weight: 900; color: var(--accent); margin: 0; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h2>FPL AI RATER <span style="color:var(--gold)">2025</span></h2>
    <div id="status" class="status-box">üîÑ Initiating Data Sync...</div>
    
    <div class="budget">BUDGET: <span id="budget-val">¬£100.0m</span></div>

    <div class="pitch">
        <div class="row"><div class="slot" data-pos="GKP"><label>GKP</label></div></div>
        <div class="row">
            <div class="slot" data-pos="DEF"><label>DEF</label></div>
            <div class="slot" data-pos="DEF"><label>DEF</label></div>
            <div class="slot" data-pos="DEF"><label>DEF</label></div>
            <div class="slot" data-pos="DEF"><label>DEF</label></div>
        </div>
        <div class="row">
            <div class="slot" data-pos="MID"><label>MID</label></div>
            <div class="slot" data-pos="MID"><label>MID</label></div>
            <div class="slot" data-pos="MID"><label>MID</label></div>
            <div class="slot" data-pos="MID"><label>MID</label></div>
        </div>
        <div class="row">
            <div class="slot" data-pos="FWD"><label>FWD</label></div>
            <div class="slot" data-pos="FWD"><label>FWD</label></div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-main" onclick="runAnalysis()">Analyze Efficiency</button>
        <button class="btn-opt" onclick="autoOptimize()">Auto-Fill Best</button>
        <button class="btn-sync" onclick="syncFPLData()">Refresh Live Data</button>
        <button style="background:#444; color:white" onclick="location.reload()">Reset All</button>
    </div>

    <div id="results" class="results">
        <h1 id="score-display" class="score-val">0.0</h1>
        <div style="font-size: 12px; color: #888; font-weight: bold;">AI SQUAD RATING</div>
        <p id="points-prediction" style="font-size: 18px; margin: 15px 0;"></p>
        <div id="ai-tip" style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 8px; font-size: 13px; text-align: left; border-left: 4px solid var(--accent);"></div>
    </div>
</div>

<script>
    let playerDB = [];

    // Dec 2025 High-Performance Backup (GW17 Stats)
    const backupPlayers = [
        {name:"Salah", pos:"MID", price:14.5, xp:9.4}, {name:"Haaland", pos:"FWD", price:14.1, xp:8.9},
        {name:"Ekitik√©", pos:"FWD", price:8.7, xp:7.6}, {name:"Palmer", pos:"MID", price:10.6, xp:7.4},
        {name:"Saka", pos:"MID", price:10.4, xp:7.1}, {name:"Cherki", pos:"MID", price:6.6, xp:6.7},
        {name:"Foden", pos:"MID", price:8.9, xp:7.2}, {name:"Gabriel", pos:"DEF", price:6.4, xp:5.1},
        {name:"J.Timber", pos:"DEF", price:6.1, xp:4.9}, {name:"Gvardiol", pos:"DEF", price:6.3, xp:5.0},
        {name:"Raya", pos:"GKP", price:5.6, xp:4.6}, {name:"Verbruggen", pos:"GKP", price:4.7, xp:4.1},
        {name:"Mbeumo", pos:"MID", price:7.9, xp:6.4}, {name:"Wood", pos:"FWD", price:6.6, xp:5.8}
    ];

    async function syncFPLData() {
        const status = document.getElementById('status');
        status.textContent = "Trying High-Speed Proxy (2025)...";
        
        // Proxy 1: corsproxy.io (Faster) | Proxy 2: allorigins (Reliable)
        const proxies = [
            'https://corsproxy.io/?url=',
            'https://api.allorigins.win/get?url='
        ];
        const api = 'https://fantasy.premierleague.com/api/bootstrap-static/';

        for (let pxy of proxies) {
            try {
                const response = await fetch(pxy + encodeURIComponent(api), { signal: AbortSignal.timeout(5000) });
                if (!response.ok) throw new Error();
                
                let data;
                if (pxy.includes("allorigins")) {
                    const wrapper = await response.json();
                    data = JSON.parse(wrapper.contents);
                } else {
                    data = await response.json();
                }

                playerDB = data.elements.map(p => ({
                    name: p.web_name,
                    pos: ["", "GKP", "DEF", "MID", "FWD"][p.element_type],
                    price: p.now_cost / 10,
                    xp: parseFloat(p.ep_next) || 0
                })).sort((a,b) => b.xp - a.xp);

                status.innerHTML = "‚úÖ <b>SYNC SUCCESS:</b> Using Live FPL Server Data";
                status.style.color = "#2ecc71";
                renderOptions();
                return;
            } catch (err) {
                console.warn("Proxy timeout, trying next...");
            }
        }

        // FALLBACK
        playerDB = backupPlayers;
        status.innerHTML = "‚ö†Ô∏è <b>TIMEOUT:</b> Servers busy. Loaded Dec 2025 Backup Engine.";
        status.style.color = "#f39c12";
        renderOptions();
    }

    function renderOptions() {
        document.querySelectorAll('.slot').forEach(slot => {
            const pos = slot.dataset.pos;
            let sel = slot.querySelector('select');
            if(!sel) {
                sel = document.createElement('select');
                sel.onchange = updateBudgetUI;
                slot.appendChild(sel);
            }
            sel.innerHTML = `<option value="">-- Select --</option>`;
            playerDB.filter(p => p.pos === pos).slice(0, 50).forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.name;
                opt.textContent = `${p.name} (¬£${p.price}m)`;
                sel.appendChild(opt);
            });
        });
    }

    function updateBudgetUI() {
        let cost = 0;
        document.querySelectorAll('select').forEach(s => {
            const p = playerDB.find(x => x.name === s.value);
            if(p) cost += p.price;
        });
        const left = (100 - cost).toFixed(1);
        const el = document.getElementById('budget-val');
        el.textContent = `¬£${left}m`;
        el.style.color = left < 0 ? "var(--error)" : "var(--pg)";
    }

    function runAnalysis() {
        const team = Array.from(document.querySelectorAll('select'))
                          .map(s => playerDB.find(p => p.name === s.value))
                          .filter(Boolean);
        
        if(team.length < 11) return alert("Squad incomplete! Add all 11 players.");

        const totalXP = team.reduce((a, b) => a + b.xp, 0);
        const totalCost = team.reduce((a, b) => a + b.price, 0);
        
        let score = (totalXP / 72) * 100;
        if(totalCost > 100) score -= (totalCost - 100) * 12;

        document.getElementById('results').style.display = 'block';
        document.getElementById('score-display').textContent = Math.max(0, score).toFixed(1);
        document.getElementById('points-prediction').textContent = `~${totalXP.toFixed(1)} Predicted Pts`;

        // Smart Transfer Recommendation
        const worst = team.reduce((a, b) => a.xp < b.xp ? a : b);
        const upgrade = playerDB.find(p => p.pos === worst.pos && p.price <= (worst.price + 0.2) && p.xp > worst.xp && !team.some(t => t.name === p.name));
        
        document.getElementById('ai-tip').innerHTML = upgrade ? 
            `üöÄ <b>Transfer Recommendation:</b> Upgrade <b>${worst.name}</b> to <b>${upgrade.name}</b>. It fits your budget and adds +${(upgrade.xp - worst.xp).toFixed(1)} expected points.` : 
            "üíé <b>AI Status:</b> Your squad is mathematically optimal for your budget.";
            
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function autoOptimize() {
        let bank = 100;
        const selects = document.querySelectorAll('select');
        selects.forEach(s => {
            const pos = s.parentElement.dataset.pos;
            const best = playerDB.find(p => p.pos === pos && p.price <= (bank/5) && !Array.from(selects).some(sel => sel.value === p.name));
            if(best) { s.value = best.name; bank -= best.price; }
        });
        updateBudgetUI();
        runAnalysis();
    }

    // Initial load
    syncFPLData();
</script>

</body>
</html>
